<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Koduino: Ghost</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <!-- ADDED THIS CELL -->
  <!--td style="font: 300 16px Lato,sans-serif;background-color: #eeeeee;padding: 10px;border-right:2px solid #ddd;">
  <a href="/" style="color:#444444">&#8679; avikde.me</a>
  </td-->
  <td style="padding-left: 0.5em;">
   <div id="projectname">Koduino
   </div>
   <div id="projectbrief">Arduino core for STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Ghost</div>  </div>
</div><!--header-->
<div class="contents">
<h1>Getting started</h1>
<p>Page created for <a href="http://www.ghostrobotics.io/">http://www.ghostrobotics.io/</a>. This guide assumes the robot is fully assembled. </p><hr/>
<h2>1. Getting to know the hardware</h2>
<h3>1.1. Day-to-day usage</h3>
<h4>1.1.1 Removing the top plate</h4>
<p>Unscrew the four bolts on the simple top plate or slide the panel off from between the Picatinny mounts depending on configuration. Remove battery by undoing the velcro strap and try to minimize tension on the battery wires during removal.</p>
<div class="image">
<img src="../openhatch.jpg"  alt="Minitaur with top panel off" title="Minitaur with top panel off"/>
</div>
<h4>1.1.2. Charging the battery</h4>
<p><b>WARNING: Handle the battery very carefully.</b> If the battery is dropped, immediately place it in a LiPo-safe bag and never use it again.</p>
<p><b>WARNING: Never over-discharge the battery</b> Check the voltage every 5-10 minutes while running the robot. If the voltage is lower than 14V, charge the battery. A future mainboard update may incorporate this functionality, but for now you are welcome to use a LiPo low voltage alarm such as <a href="http://www.hobbyking.com/hobbyking/store/__41178__HobbyKing_8482_Lipoly_Low_Voltage_Alarm_2s_4s_US_Warehouse_.html">this one</a>.</p>
<p>Use the following charger settings:</p><ol type="1">
<li>LiPo Charge 4S</li>
<li>Capacity 5300 mAh</li>
<li>10A max current</li>
<li><b>Never leave a charging battery unattended</b></li>
</ol>
<h4>1.1.3. Using the remote</h4>
<p>The default mappings as of 2016/07/25: </p><div class="image">
<img src="../remote.jpg"  alt="Remote mappings in default firmware" title="Remote mappings in default firmware"/>
</div>
<p><b>WARNING:</b> In the default minitaur firmware, the robot starts operating as soon as the remote connects. Make sure the <code>behavior on/off</code> switch (top left) is at <code>2</code> (down) before turning on the remote.</p>
<p>These mappings, as well as the sensitivities, are not fixed, and can be changed in software. The default firmware comes with a low sensitivity.</p>
<h4>1.1.4. Logging data</h4>
<p>The default firmware logs</p><ul>
<li>motor positions,</li>
<li>motor torque esimates,</li>
<li>filtered <a class="el" href="class_i_m_u.html" title="Base IMU class that any IMU hardware should derive from. ">IMU</a> data (angles and angular rates),</li>
<li>forward speed estimate,</li>
<li>some discrete states (stance/flight etc.) at approximately 100 Hz.</li>
</ul>
<p>To log some data,</p><ol type="1">
<li>Get a micro SD card formatted FAT32 (up to 64GB should be fine)</li>
<li>Place the following text in a file called <code>CONFIG.TXT</code> <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;115200,26,3,0,1,1,0</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;baud,escape,esc#,mode,verb,echo,ignoreRX</div>
</div><!-- fragment --></li>
<li>Insert the micro SD card in the vertical socket on the mainboard with the gold contacts facing down, and towards the micro USB connector on the mainboard. Be careful, it's easy to insert it crooked, but ultimately it only goes in one way.</li>
</ol>
<p>To read these logs, first, you need to have Python:</p><ol type="1">
<li>Install Python 2.7 using package managers (on Linux/Mac), or from <a href="https://www.continuum.io/downloads">Anaconda</a> (recommended on Windows)</li>
<li>Right click the Windows start button, click <code>System</code>, and then click <code>Advanced system settings</code> on the left.</li>
<li>Click <code>Environment variables</code> in the windows that opens.</li>
<li>Click <code>New...</code> in the top pane; enter <code>KODUINO_DIR</code> for "variable name," and <code>C:\Users\&lt;username&gt;\Documents\arduino-1.6.1\hardware\koduino\stm32</code> for "Variable value," where you replace <code>&lt;username</code> with your Windows username. Click <code>OK</code>.</li>
<li>Select the existing environment variable <code>PATH</code>, click <code>Edit...</code></li>
<li>Make sure these three folders are in the path: <code>C:\Users\&lt;username&gt;\Anaconda2</code>, <code>C:\Users\&lt;username&gt;\Anaconda2\Scripts</code>, <code>C:\Users\&lt;username&gt;\Anaconda2\Library\bin</code></li>
<li>Open a new command prompt or terminal window. Type <code>conda install numpy scipy matplotlib</code></li>
<li>To test that that worked, type <code>python</code> in command prompt.</li>
</ol>
<p>To use Python to open the latest log, follow the instructions under the "Example: Reading on a computer" heading in <a href="http://avikde.me/koduino/html/class_open_log.html">http://avikde.me/koduino/html/class_open_log.html</a></p>
<h4>1.1.5. Modular payload system</h4>
<div class="image">
<img src="../payload.jpg"  alt="Payload" title="Payload"/>
</div>
<h3>1.2. Getting familiar with the mainboard</h3>
<div class="image">
<img src="../mblc0.5.2.jpg"  alt="Mainboard" title="Mainboard"/>
</div>
<h4>1.2.1. Power distribution and switch</h4>
<p>The two bullet terminals at the bottom are meant to have a high-current hard on/off switch connected across them. We recommend using AWG10 or lower for the wires here. If you are using a power supply to power motors, these can just be connected with a (low AWG) wire.</p>
<p>There are two switching regulators on board: 3.4V @ 25.A, and 5V @ 2.5A (only turns on when V+ &gt; 8V is connected).</p>
<p><b>Note:</b> the rest of the 1.2.x section is for advanced customization, and can be skipped if this is your first time setting things up.</p>
<h4>1.2.2. Interfacing with analog sensors</h4>
<p>Four analog inputs are conveniently located near where the remote is connected:</p>
<div class="image">
<img src="../adc.jpg"  alt="Mainboard ADC" title="Mainboard ADC"/>
</div>
<p>All of them are set up for ADC, so you can just use <a href="http://avikde.me/koduino/html/group___analog.html">analogRead</a>.</p>
<p><b>WARNING:</b> The ADC pins are not 5V tolerant; make sure your sensor is outputting a voltage less than 3.3V, or use level shifters.</p>
<h4>1.2.3. Interfacing with digital peripherals</h4>
<p><b>Serial/USART:</b> <a href="http://avikde.me/koduino/html/class_u_s_a_r_t_class.html">Serial2</a> is available on pins 8 (RX) and 10 (TX) on the 2x20 RASPI header.</p>
<p><b>SPI:</b> SPI1 is available 4x2 header (image below) </p><div class="image">
<img src="../spi.jpg"  alt="Mainboard SPI" title="Mainboard SPI"/>
</div>
<p>The pin names for the SPI functions are:</p><ul>
<li>SS &ndash; PA4 (this is just a digital pin, convenient to use for SS)</li>
<li>SCK &ndash; PA5</li>
<li>MISO &ndash; PA6</li>
<li>MOSI &ndash; PA7</li>
<li>PC4 and PF4 are just two available GPIO pins</li>
</ul>
<p><b>FIXME:</b> for now need to use <a href="http://avikde.me/koduino/html/class_s_p_i_class.html">SPI.setPins</a>, but in a future koduino update these pins will be made the default for SPI1, so that you can just call <a href="http://avikde.me/koduino/html/class_s_p_i_class.html">SPI.begin</a> etc.</p>
<h4>1.2.4. Interfacing with other computers / microcontrollers</h4>
<p>The micro USB programming port can also be used for communication with the host computer. In mainboard code, it is connected to <a href="http://avikde.me/koduino/html/class_u_s_a_r_t_class.html">Serial1</a> which works just like the <a href="https://www.arduino.cc/en/Reference/Serial">Arduino Serial class</a>.</p>
<p>The mainboard in itself does not have any wireless capabilities, but keep the following subsection in mind:</p>
<h5>1.2.4.1. Raspberry Pi</h5>
<p>This can be plugged directly to the mainboard, lining up the four mounting holes and the 2x20 header. For mechanical attachment:</p><ul>
<li>some spacers are needed to separate the boards</li>
<li>to use M3 bolts, the mounting holes on the Raspberry Pi should be drilled out to 3mm</li>
</ul>
<p>In terms of the electrical connection,</p><ul>
<li>the Pi is powered by the 5V regulator on the mainboard (only on when V+ &gt; 8V is connected),</li>
<li>the UART on the 2x20 header interfaces with Serial2 on the mainboard</li>
</ul>
<p>In a future update, we will make a basic ROS interface available to the robot, including software to establish communication between the Pi and the mainboard.</p>
<h5>1.2.4.2. Interfacing with a different computer</h5>
<p>If interfacing with a different computer, it is easiest to use Serial1 through the micro USB connection.</p>
<h5>1.2.4.3. Interfacing with other microcontrollers</h5>
<p>The mett is easiest to use Serial1 on the mainboard, which is connected to the Micro USB programming port.</p>
<h4>1.2.5. Interfacing with hobby servos</h4>
<p>Up to 4 hobby servos can be connected to the 4x3 header: </p><div class="image">
<img src="../servo.jpg"  alt="Mainboard servo" title="Mainboard servo"/>
</div>
<ul>
<li>the whole second columns is Vsrv and the whole third column is GND</li>
<li>Vsrv can be selected as 3.3V or 5V, using the jumper on the bottom side of the board <b>NOTE:</b> the jumper must be closed on only one side! On a brand new board it is open and so Vsrv is connected to nothing</li>
</ul>
<p>The pins PE2&ndash;PE5 are already set up for PWM, and you can just use <a href="http://avikde.me/koduino/html/group___p_w_m.html">analogWriteFloat or analogWrite</a>. Make sure the <a href="http://avikde.me/koduino/html/group___p_w_m.html">analogWriteFrequency</a> is set low enough!</p>
<hr/>
<h3>2.1. Get your computer ready</h3>
<p>The following instructions are for Windows for now.</p>
<h4>2.1.1. Get the Arduino IDE</h4>
<ol type="1">
<li>Get Arduino 1.6.1 (zip): e.g. <a href="http://arduino.cc/download.php?f=/arduino-1.6.1-windows.zip">Windows link</a>, etc. <em>Note: it MUST be 1.6.1, and not a later version, for now.</em></li>
<li>Unzip to a location on your computer (your <code>Documents\</code> directory is recommended)</li>
</ol>
<h4>2.1.2. Get the microcontroller libraries</h4>
<p>I recommend cloning the repository to your computer so that you can easily update to the latest code in the future.</p><ol type="1">
<li>Download <a href="https://www.sourcetreeapp.com/">SourceTree</a> and install it</li>
<li>Open SourceTree, click <code>Clone / New</code> on the toolbar</li>
<li>Enter the URL <code><a href="https://github.com/avikde/koduino.git">https://github.com/avikde/koduino.git</a></code></li>
<li>Under <code>Destination Path</code>, click <code>...</code> and navigate to (a) <code>Documents\arduino-1.6.1\hardware\koduino</code> (Windows), or (b) <code>/Applications/Arduino.app/Contents/Resources/Java/hardware</code> (Mac)</li>
<li>Click <code>Clone</code> and wait for it to finish</li>
<li>If Arduino is open, you must close and re-open it any time you make changes to the <code>arduino\hardware</code> directory.</li>
</ol>
<p>To get the latest version of the libraries at any later time, just open SourceTree, double click <code>koduino</code> on the left, and click the <code>Pull</code> button on the toolbar.</p>
<h4>2.1.3. (Mac only) Get the FTDI drivers</h4>
<p>The default Mac FTDI drivers can't do the auto-reset to bootloader.</p><ol type="1">
<li>Go to <a href="http://www.ftdichip.com/Drivers/VCP.htm">http://www.ftdichip.com/Drivers/VCP.htm</a> and get the latest driver for your OS</li>
<li>Restart</li>
</ol>
<h3>2.2. Upload a Blink sketch</h3>
<p>The main microcontroller board at the center of the robot is called the "mainboard." It's very easy to program it using Arduino.</p>
<ol type="1">
<li>Open <code>Documents\arduino-1.6.1\arduino.exe</code></li>
<li>Click <code>Tools -&gt; Board -&gt; F303V (...)</code></li>
<li>Select <code>Tools -&gt; Bootloader -&gt; Serial</code>, and <code>Tools -&gt; CPU Speed -&gt; 72 MHz</code></li>
<li>Make sure the mainboard is <em>NOT</em> plugged in</li>
<li>Click <code>Tools -&gt; Port</code> and look at which COM ports are listed</li>
<li>Now plug in a Micro-B USB cable from your computer to the mainboard. Check that at least the red power LED has turned on.</li>
<li>Click <code>Tools -&gt; Port</code> again; a new COM port should have appeared. Select the new COM port.</li>
<li>Paste in the code below <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Arduino.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Change to whatever pin an LED is connected to</span></div>
<div class="line"><span class="keyword">const</span> uint8_t led = PD0;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <a class="code" href="group___pins.html#ga34d257d1f45a539062543dc6f0aea730">pinMode</a>(led, OUTPUT);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <a class="code" href="group___digital.html#ga83a60de700245d1262ec6bb1c6f54cb7">digitalWrite</a>(led, TOGGLE);</div>
<div class="line">  <a class="code" href="group___time.html#ga3194c3cfc86e8c279646fd44f3e2ee4d">delay</a>(1000);</div>
<div class="line">}</div>
</div><!-- fragment --></li>
<li>If you prefer to use the <code>Makefile</code> build system (everyone else, specifically those on Windows, please skip this step), you can use the following Makefile <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;VARIANT = f303v</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;UPLOAD_METHOD = SERIAL</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;UPLOAD_ENTRY = mblc</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# UPLOAD_PORT = COM4</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;HSE_VALUE = 8000000UL</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;KODUINO_ISRS = INLINE</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# 72MHz</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;CLKSRC = HSE_8M</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;# overclocked to 112 MHz</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# CLKSRC = HSE_8M_OC112</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;# Don&#39;t save EEPROM</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;EEP_START = 0x0800F000</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;EEP_LEN = 0</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;# 256kB</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;MAX_PROGRAM_SIZE = 262144</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;LIBRARIES = </div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;include $(KODUINO_DIR)/project.mk</div>
</div><!-- fragment --></li>
<li>Click <code>File -&gt; Upload</code>, and wait for 10-20 seconds till a success or failure message appears at the bottom. Sometimes if the upload fails, try just unplugging and plugging the mainboard in right after you click "Upload" and trying again. <em>Hint: you can also enable verbose compilation/upload output in the Arduino console from Arduino's Preferences menu.</em></li>
<li>After successfully uploading, look at the mainboard. The green LED should be blinking once per second</li>
</ol>
<h3>2.3. Programming legs</h3>
<h4>2.3.1. Leg numbering</h4>
<div class="image">
<img src="../legnumbering.jpg"  alt="Leg Numbering" title="Leg Numbering"/>
</div>
<h4>2.3.2 Zeroing motors</h4>
<p>Just once per actuator module, the encoder absolute encoder zeros need to be calibrated.</p>
<ul>
<li>The motor zeros are hard-coded for now. To do this, look at the "Setting motor zero" section of the <a href="http://avikde.me/koduino/html/group___motor_controller.html">motor controller library docs</a>.</li>
<li><a href="../GhostMinitaurLegZeroJig.STL">CAD file for leg zeroing jig</a> &ndash; 3D print this to help zero the motors</li>
</ul>
<h4>2.3.3 Driving motors with setOpenLoop and setPosition</h4>
<p>See the <a href="http://avikde.me/koduino/html/group___motor_controller.html">motor controller library docs</a>. Specifically, the <a href="http://avikde.me/koduino/html/class_minitaur_leg.html">MinitaurLeg class</a> will be important.</p>
<h3>2.4. Template code</h3>
<p>Download these (right click, save as)</p><ul>
<li><a href="../code/mblc_template.ino">Mainboard template</a> &ndash; basic mainboard code &ndash; <em>updated 2016/08/01</em></li>
<li><a href="../code/minitaur.zip">Minitaur bounding firmware (BETA)</a> &ndash; <em>updated 2016/08/01</em></li>
</ul>
<p><b>NOTE:</b> For either of these, <b>you MUST check the leg zeros</b> for your specific robot before enabling motors. In the default minitaur firmware, the motors are enabled on power-up!</p>
<h3>2.5. API documentation</h3>
<p>There is a lot of <a href="http://avikde.me/koduino/html/">API documentation</a>! </p><hr/>
<p>coming soon </p>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Aug 17 2016 21:32:18 for Koduino by &#160;<a href="http://www.doxygen.org/index.html">
Doxygen
</a> 1.8.10
</small></address>
</body>
</html>
