<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>Koduino: Brushless Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <!-- ADDED THIS CELL -->
  <!--td style="font: 300 16px Lato,sans-serif;background-color: #eeeeee;padding: 10px;border-right:2px solid #ddd;">
  <a href="/" style="color:#444444">&#8679; avikde.me</a>
  </td-->
  <td style="padding-left: 0.5em;">
   <div id="projectname">Koduino
   </div>
   <div id="projectbrief">Arduino core for STM32</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_brushless-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">Brushless Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="_brushless_8h_source.html">Brushless.h</a>&gt;</code></p>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><b>INCOMPLETE!</b></p>
<h3>Usage</h3>
<h3>Example: Blink</h3>
<div class="fragment"></div><!-- fragment --> </div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a1a0a60dd47c15724d330d73d3c409037"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#a1a0a60dd47c15724d330d73d3c409037">setMotorPhases</a> (float electricalAngle, float amplitude, CommutationType waveform)</td></tr>
<tr class="memdesc:a1a0a60dd47c15724d330d73d3c409037"><td class="mdescLeft">&#160;</td><td class="mdescRight">Command the phases for a specific electrical angle.  <a href="#a1a0a60dd47c15724d330d73d3c409037">More...</a><br /></td></tr>
<tr class="separator:a1a0a60dd47c15724d330d73d3c409037"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43609000cd8abbcc93b5956a010a391e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#a43609000cd8abbcc93b5956a010a391e">setMotorProps</a> (int polePairs, float leadFactor)</td></tr>
<tr class="memdesc:a43609000cd8abbcc93b5956a010a391e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set basic motor properties (call before <a class="el" href="class_brushless.html#a1bcb0eb245f4dd4d0b1345b1334253ff" title="Initialize commutation from absolute position. ">init()</a>)  <a href="#a43609000cd8abbcc93b5956a010a391e">More...</a><br /></td></tr>
<tr class="separator:a43609000cd8abbcc93b5956a010a391e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bcb0eb245f4dd4d0b1345b1334253ff"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#a1bcb0eb245f4dd4d0b1345b1334253ff">init</a> (uint32_t absPos, int commutationRate)</td></tr>
<tr class="memdesc:a1bcb0eb245f4dd4d0b1345b1334253ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize commutation from absolute position.  <a href="#a1bcb0eb245f4dd4d0b1345b1334253ff">More...</a><br /></td></tr>
<tr class="separator:a1bcb0eb245f4dd4d0b1345b1334253ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01bb9cebd1eb84538bdab2d63b7d39a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a01bb9cebd1eb84538bdab2d63b7d39a8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#a01bb9cebd1eb84538bdab2d63b7d39a8">commutate</a> ()</td></tr>
<tr class="memdesc:a01bb9cebd1eb84538bdab2d63b7d39a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads the position and sets the motor phases; should be called at at least 5KHz. <br /></td></tr>
<tr class="separator:a01bb9cebd1eb84538bdab2d63b7d39a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86f0f5b944c1a78078d2d279fe21ff3c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#a86f0f5b944c1a78078d2d279fe21ff3c">calibrate</a> (float sweepAmplitude, uint32_t pauseDuration)</td></tr>
<tr class="memdesc:a86f0f5b944c1a78078d2d279fe21ff3c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calibration routine which (a) detects wire orientation, and (b) determines magnet zero by spinning back and forth.  <a href="#a86f0f5b944c1a78078d2d279fe21ff3c">More...</a><br /></td></tr>
<tr class="separator:a86f0f5b944c1a78078d2d279fe21ff3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8ff2ae59988c8d2c3a78e641376ac98"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_brushless.html#ac8ff2ae59988c8d2c3a78e641376ac98">update</a> (float pwmInput)</td></tr>
<tr class="memdesc:ac8ff2ae59988c8d2c3a78e641376ac98"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the desired amplitude.  <a href="#ac8ff2ae59988c8d2c3a78e641376ac98">More...</a><br /></td></tr>
<tr class="separator:ac8ff2ae59988c8d2c3a78e641376ac98"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a86f0f5b944c1a78078d2d279fe21ff3c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Brushless::calibrate </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sweepAmplitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>pauseDuration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calibration routine which (a) detects wire orientation, and (b) determines magnet zero by spinning back and forth. </p>
<p>This will first command 3 positions in open loop to determine the order of the wires, and write this setting to EEPROM position 1. Next, it will spin the motor back and forth, doing gradient descent on the total angle swept till it spins equally well in both directions. It writes the magnet zero to EEPROM position 0.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sweepAmplitude</td><td>The amplitude of the sweeping back and forth. This should be increased for low Kv motors, decreased when bus voltage is higher. </td></tr>
    <tr><td class="paramname">pauseDuration</td><td>ms to stop for. Need higher for higher inertia motors. Default = 500 </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1bcb0eb245f4dd4d0b1345b1334253ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Brushless::init </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>absPos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>commutationRate</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize commutation from absolute position. </p>
<p>Call this right before calling <a class="el" href="group___timebase.html#ga5bf1468dbfe70bf8a0a511df76075992" title="Begin a timer interrupt. ">attachTimerInterrupt()</a> with the commutation function</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">absPos</td><td>Absolute rotor position </td></tr>
    <tr><td class="paramname">commutationRate</td><td>Rate at which commutation will occur </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a1a0a60dd47c15724d330d73d3c409037"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Brushless::setMotorPhases </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>electricalAngle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>amplitude</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">CommutationType&#160;</td>
          <td class="paramname"><em>waveform</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Command the phases for a specific electrical angle. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">electricalAngle</td><td>Current electrical angle in [0, 1] </td></tr>
    <tr><td class="paramname">amplitude</td><td>Amplitude in [-1, 1] </td></tr>
    <tr><td class="paramname">waveform</td><td>One of <code>BLOCK</code>, <code>SINUSOIDAL</code>, <code>TRAPEZOIDAL</code> </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a43609000cd8abbcc93b5956a010a391e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Brushless::setMotorProps </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>polePairs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>leadFactor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set basic motor properties (call before <a class="el" href="class_brushless.html#a1bcb0eb245f4dd4d0b1345b1334253ff" title="Initialize commutation from absolute position. ">init()</a>) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">polePairs</td><td>Number of pole pairs </td></tr>
    <tr><td class="paramname">leadFactor</td><td>Lead factor (start with 0 and hand-tune) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac8ff2ae59988c8d2c3a78e641376ac98"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Brushless::update </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>pwmInput</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update the desired amplitude. </p>
<p>This does not need to be called as frequently as commutation, or at a regular rate (for example, this can go in loop()).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pwmInput</td><td>The PWM input. Acceptable duty cycle is [0.1, 0.9], which is mapped to [-1, 1] motor amplitude. Anything outside [0.1, 0.9] disables the motor as a communication failsafe. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="_brushless_8h_source.html">Brushless.h</a></li>
<li>Brushless.cpp</li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 25 2016 13:23:28 for Koduino by &#160;<a href="http://www.doxygen.org/index.html">
Doxygen
</a> 1.8.10
</small></address>
</body>
</html>
